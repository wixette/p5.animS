!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).animS={})}(this,function(e){"use strict";class v{constructor(e,t){this.x=e,this.y=t}}class g{constructor(e,t,s,i,n,r){this.x2=e,this.y2=t,this.x3=s,this.y3=i,this.x4=n,this.y4=r}}class M{constructor(e,t,s,i,n,r,h,a){this.x1=e,this.y1=t,this.x2=s,this.y2=i,this.x3=n,this.y3=r,this.x4=h,this.y4=a}static fromVetices(e,t){return new M(e.x,e.y,t.x2,t.y2,t.x3,t.y3,t.x4,t.y4)}}function w(e){return e instanceof v?new v(e.x,e.y):new v(e.x4,e.y4)}class i{constructor(e,t,s,i){if(t.length<=0)throw new Error("The vertex array must not be empty.");if(!(t[0]instanceof v))throw new Error("The start vertex must not be a Bezier vertex.");this.p5obj=e,this.vertices=t,this.startFrame=s,this.duration=i}update(){let e=(this.p5obj.frameCount-this.startFrame)/this.duration;e<0&&(e=0),1<e&&(e=1);var t,s,i,n,r,h,a,o,c,u,x=this.vertices.length-1,p=x*e,y=Math.floor(p),d=p-y;this.p5obj.beginShape(),this.p5obj.vertex(this.vertices[0].x,this.vertices[0].y);let f=w(this.vertices[0]);for(let e=0;e<y;e++){var l=this.vertices[e+1];l instanceof v?this.p5obj.vertex(l.x,l.y):this.p5obj.bezierVertex(l.x2,l.y2,l.x3,l.y3,l.x4,l.y4),f=w(l)}y<x&&((c=this.vertices[y+1])instanceof v?(a=f.x+(c.x-f.x)*d,o=f.y+(c.y-f.y)*d,this.p5obj.vertex(a,o)):(u=M.fromVetices(f,c),n=1-(s=0),r=1-(i=d),h=(t=u).x1*n*n+2*t.x2*s*n+t.x3*s*s,p=t.x1*r*r+2*t.x2*i*r+t.x3*i*i,x=t.x2*n*n+2*t.x3*s*n+t.x4*s*s,a=t.x2*r*r+2*t.x3*i*r+t.x4*i*i,o=t.y1*n*n+2*t.y2*s*n+t.y3*s*s,c=t.y1*r*r+2*t.y2*i*r+t.y3*i*i,d=t.y2*n*n+2*t.y3*s*n+t.y4*s*s,u=t.y2*r*r+2*t.y3*i*r+t.y4*i*i,t=h*n+x*s,h=h*r+x*i,x=p*n+a*s,p=p*r+a*i,a=o*n+d*s,d=o*r+d*i,s=c*n+u*s,i=c*r+u*i,i=new M(t,a,h,d,x,s,p,i),this.p5obj.bezierVertex(i.x2,i.y2,i.x3,i.y3,i.x4,i.y4))),1<=e&&1<this.vertices.length&&this.vertices[this.vertices.length-1]instanceof v&&this.vertices[0].x==this.vertices[this.vertices.length-1].x&&this.vertices[0].y==this.vertices[this.vertices.length-1].y?this.p5obj.endShape(this.p5obj.CLOSE):this.p5obj.endShape()}}class t{constructor(e){this.p5obj=e||window,this.instances_=new Map,this.dedup_=new Set}getOrCreateShapeInstance_(e,t,s){if(this.checkDuplicateId_(e))throw new Error("AnimS id must not be duplicate in the same p5.js frame.");if(this.instances_.has(e))return this.instances_.get(e);s=new i(this.p5obj,t(),this.p5obj.frameCount,s);return this.instances_.set(e,s),s}checkDuplicateId_(e){e=e+"@"+this.p5obj.frameCount;return!!this.dedup_.has(e)||(this.dedup_.add(e),!1)}reset(){this.instances_.clear(),this.dedup_.clear()}arc(e,t,y,d,f,l,w,b){if(!(b<=w||b-w<1e-5)){const s=this.getOrCreateShapeInstance_(e,()=>{y-=.5*f,d-=.5*l,f=Math.abs(f),l=Math.abs(l);const s=f/2,i=l/2;var e,t,n,r,h,a,o,c,u;y+=s,d+=i;const x=[];for(;1e-5<=b-w;)e=Math.min(b-w,Math.PI/2),x.push((t=w,o=r=u=c=o=a=h=r=void 0,r=(n=e)/2,h=Math.cos(r),a=Math.sin(r),o=1/Math.tan(r),c=t+r,u=Math.cos(c),r=Math.sin(c),o=a+(h-(c=(4-h)/3))*o,new M(Math.cos(t).toFixed(7),Math.sin(t).toFixed(7),(c*u+o*r).toFixed(7),(c*r-o*u).toFixed(7),(c*u-o*r).toFixed(7),(c*r+o*u).toFixed(7),Math.cos(t+n).toFixed(7),Math.sin(t+n).toFixed(7)))),w+=e;const p=[];return x.forEach((e,t)=>{0===t&&p.push(new v(y+e.x1*s,d+e.y1*i)),p.push(new g(y+e.x2*s,d+e.y2*i,y+e.x3*s,d+e.y3*i,y+e.x4*s,d+e.y4*i))}),p},t);s.update()}}ellipse(e,t,h,a,o,c){const s=this.getOrCreateShapeInstance_(e,()=>{h-=.5*o,a-=.5*c,o=Math.abs(o),c=Math.abs(c);var e=.5522847498,t=o/2*e,s=c/2*e,i=h+o,n=a+c,r=h+o/2,e=a+c/2;return[new v(h,e),new g(h,e-s,r-t,a,r,a),new g(r+t,a,i,e-s,i,e),new g(i,e+s,r+t,n,r,n),new g(r-t,n,h,e+s,h,e)]},t);s.update()}circle(e,t,s,i,n){n=Math.abs(n),this.ellipse(e,t,s,i,n,n)}line(e,t,s,i,n,r){const h=this.getOrCreateShapeInstance_(e,()=>[new v(s,i),new v(n,r)],t);h.update()}quad(e,t,s,i,n,r,h,a,o,c){const u=this.getOrCreateShapeInstance_(e,()=>[new v(s,i),new v(n,r),new v(h,a),new v(o,c),new v(s,i)],t);u.update()}rect(e,t,s,i,n,r){n=Math.abs(n),r=Math.abs(r),this.quad(e,t,s,i,s+n,i,s+n,i+r,s,i+r)}square(e,t,s,i,n){n=Math.abs(n),this.rect(e,t,s,i,n,n)}triangle(e,t,s,i,n,r,h,a){const o=this.getOrCreateShapeInstance_(e,()=>[new v(s,i),new v(n,r),new v(h,a),new v(s,i)],t);o.update()}shape(e,t,s){const i=this.getOrCreateShapeInstance_(e,()=>{const e=[];for(const t of s)if(2==t.length)e.push(new v(t[0],t[1]));else{if(6!=t.length)throw new Error("Only simple vertices (x, y) or Bezier vertices (x2, y2, x3, y3, x4, y4) are supported.");e.push(new g(t[0],t[1],t[2],t[3],t[4],t[5]))}return e},t);i.update()}}const u=new t;e.arc=function(e,t,s,i,n,r,h,a){u.arc(e,t,s,i,n,r,h,a)},e.circle=function(e,t,s,i,n){u.circle(e,t,s,i,n)},e.ellipse=function(e,t,s,i,n,r){u.ellipse(e,t,s,i,n,r)},e.line=function(e,t,s,i,n,r){u.line(e,t,s,i,n,r)},e.newAnimS=function(e){return new t(e)},e.quad=function(e,t,s,i,n,r,h,a,o,c){u.quad(e,t,s,i,n,r,h,a,o,c)},e.rect=function(e,t,s,i,n,r){u.rect(e,t,s,i,n,r)},e.reset=function(){u.reset()},e.shape=function(e,t,s){u.shape(e,t,s)},e.square=function(e,t,s,i,n){u.square(e,t,s,i,n)},e.triangle=function(e,t,s,i,n,r,h,a){u.triangle(e,t,s,i,n,r,h,a)},Object.defineProperty(e,"__esModule",{value:!0})});